/*!
 * Blast Mojo Framework
 * Available under the MIT License
 * 
 * Copyright (c) 2007-2011, Blast Radius Inc. All Rights Reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
var mojo={version:"2.0",evaluateClassPath:function(e){var d=e.split(".");var b=window;for(var a=d.length,c=0;c<a;c++){if(b){b=b[d[c]];}}return b;},define:function(a,b){var c=function(d){if(d.match(/Controller/gi)){return mojo.controller.Controller;}if(d.match(/Command/gi)){return mojo.command.Command;}if(d.match(/Behavior/gi)){return mojo.command.Behavior;}}(a);mojo.provide(a);mojo.declare(a,c,b);},require:dojo.require,query:function(d,c){if(c&&(typeof c=="string"||typeof c=="object")){var b=dojo.query(d,c);}else{if((new RegExp(/^\#[a-zA-Z0-9\-\_]*$/)).test(d)){var a=document.getElementById(d.substring(1));if(a){var b=[a];}else{var b=[];}}else{var b=dojo.query(d);}}return b;},queryFirst:function(c,b){var a=mojo.query(c,b);if(a.length>0){return a[0];}return null;},queryMatch:function(b,h,f,c){if(!b||b==f){return null;}var g=false;var e=[];if((new RegExp(/^[\#|\.]?[a-zA-Z0-9\-\_]+$/)).test(h)){g=true;}else{e=mojo.query(h,f);}while(b&&b!=f){if(g){if((h.indexOf("#")==0&&b.id==h.substring(1))||(h.indexOf(".")==0&&dojo.hasClass(b,h.substring(1)))||(b.tagName&&b.tagName.toLowerCase()==h.toLowerCase())){return b;}}else{for(var d=0,a=e.length;d<a;d++){if(e[d]==b){return b;}}}if(c){b=b.parentNode;}else{break;}}return null;}};dojo.provide("mojo.command.Behavior");dojo.declare("mojo.command.Behavior",null,{_requestObj:null,getRequest:function(){if(!this._requestObj){throw new Error("ERROR mojo.command.Behavior.getRequest - requestObj is not set");}return this._requestObj;},_execute:function(b){this._requestObj=b;if(typeof(b.update)=="function"){b.update();}if(this._requestObj==null||(!this._requestObj)){throw new Error("ERROR mojo.command.Behavior._execute - requestObj is not set");}else{if(!(this._requestObj instanceof mojo.controller.Request)){throw new Error("ERROR mojo.command.Behavior._execute - requestObj is not type of mojo.controller.Request");}else{if(!this._requestObj.callerObj){throw new Error("ERROR mojo.command.Behavior._execute - callerObj is not set");}}}if(!b.getParams()&&typeof(b.getParams())=="boolean"){return;}if(dojo.config&&dojo.config.isDebug){try{return this.execute(b);}catch(a){console.debug("EXCEPTION: "+a.message+" in mojo.command.Behavior.execute() for behavior: "+b.getCommandName()+", controller: "+b.getControllerName());}}else{return this.execute(b);}},execute:function(a){throw new Error("ERROR mojo.command.Behavior.execute - execute() method is not implemented");}});dojo.provide("mojo.command.Command");dojo.declare("mojo.command.Command",null,{_requestObj:null,getRequest:function(){if(!this._requestObj){throw new Error("ERROR mojo.command.Command.getRequest - requestObj is not set");}return this._requestObj;},_execute:function(b){this._requestObj=b;if(typeof(b.update)=="function"){b.update();}if(this._requestObj==null||(!this._requestObj)){throw new Error("ERROR mojo.command.Command._execute - requestObj is not set");}else{if(!(this._requestObj instanceof mojo.controller.Request)){throw new Error("ERROR mojo.command.Command._execute - requestObj is not type of mojo.controller.Request");}}if(!b.getParams()&&typeof(b.getParams())=="boolean"){return;}if(dojo.config&&dojo.config.isDebug){try{return this.execute(b);}catch(a){console.debug("EXCEPTION: "+a.message+" in mojo.command.Command.execute() for command: "+b.getCommandName()+", controller: "+b.getControllerName());}}else{return this.execute(b);}},execute:function(a){throw new Error("ERROR mojo.command.Command.execute - execute() method is not implemented");},onResponse:function(a){throw new Error("ERROR mojo.command.Command.onResponse - onResponse() method is not implemented");},onError:function(a){throw new Error("ERROR mojo.command.Command.onError - onError() method is not implemented");}});dojo.provide("mojo.command.Rule");dojo.declare("mojo.command.Rule",null,{_requestObj:null,getRequest:function(){if(!this._requestObj){throw new Error("ERROR mojo.command.Rule.getRequest -requestObj is not set");}return this._requestObj;},_execute:function(b){this._requestObj=b;if(typeof(b.update)=="function"){b.update();}if(this._requestObj==null||(!this._requestObj)){throw new Error("ERROR mojo.command.Rule._execute - requestObj is not set");}else{if(!(this._requestObj instanceof mojo.controller.Request)){throw new Error("ERROR mojo.command.Rule._execute - requestObj is not type of mojo.controller.Request");}else{if(!this._requestObj.callerObj){throw new Error("ERROR mojo.command.Rule._execute - callerObj is not set");}else{if(!this._requestObj.invocation){throw new Error("ERROR mojo.command.Rule._execute - invocation is not set");}}}}if(dojo.config&&dojo.config.isDebug){try{if(this.execute(b)){return true;}return false;}catch(a){console.debug("EXCEPTION: "+a.message+" in mojo.command.Rule.execute() for rule: "+b.getCommandName()+", controller: "+b.getControllerName());}}else{if(this.execute(b)){return true;}return false;}try{}catch(a){}},execute:function(a){if(this.condition(a)){return a.invocation.proceed();}},condition:function(a){throw new Error("ERROR mojo.command.Rule.condition - condition() method is not implemented");}});dojo.provide("mojo.service.Locator");__mojoServiceRegistry=new Array();dojo.declare("mojo.service.Locator",null,{constructor:function(){if(__mojoServiceRegistry.length==0){this.addServices();}},addServices:function(){if(dojo.config&&dojo.config.isDebug){console.debug("ERROR mojo.service.Locator - addServices() not implemented");}},addService:function(a){if(a==null||typeof a=="undefined"){throw (new Error("ERROR mojo.service.Locator.addService - serviceObj parameter is required"));}if(!(a instanceof mojo.service.Service)){throw (new Error("ERROR mojo.service.Locator.addService - serviceObj parameter must be an instance of the mojo.service.Service class"));}var b=a.getName();if(!__mojoServiceRegistry[b]){__mojoServiceRegistry[b]=a;}else{throw (new Error('ERROR mojo.service.Locator.addService - service with the name "'+b+'" already exists in the registry; service not added'));}},getService:function(a){if(a==null||typeof a=="undefined"){throw new Error("ERROR mojo.service.Locator.getService - name parameter is required");}if(!dojo.isString(a)||a==""){throw new Error("ERROR mojo.service.Locator.getService - name parameter must be a non-empty string");}return __mojoServiceRegistry[a]||null;}});dojo.provide("mojo.service.Service");dojo.declare("mojo.service.Service",null,{VALID_METHODS:["GET","POST","PUT","DELETE"],DEFAULT_PARAMS:{format:"json",method:"GET",cacheExpiry:0,cache:true,retry:1,hijax:false,inferArrays:true},constructor:function(a,b,c){if(a==null||typeof a=="undefined"){throw new Error("ERROR mojo.service.Service.constructor - name parameter is required");}if(!dojo.isString(a)||a==""){throw new Error("ERROR mojo.service.Service.constructor - name parameter must be a non-empty string");}if(b==null||typeof b=="undefined"){throw new Error("ERROR mojo.service.Service.constructor - uri parameter is required");}if(!dojo.isString(b)||b==""){throw new Error("ERROR mojo.service.Service.constructor - uri parameter must be a non-empty string");}var d={};for(property in this.DEFAULT_PARAMS){d[property]=this.DEFAULT_PARAMS[property];}if(a.toLowerCase().indexOf("add")==0){d.method="POST";}else{if(a.toLowerCase().indexOf("update")==0){d.method="PUT";}else{if(a.toLowerCase().indexOf("delete")==0){d.method="DELETE";}}}if(c){if(c.method){if(c.method!="GET"){d.cache=false;}}else{if(d.method!="GET"){d.cache=false;}}if(c.method){if(c.method!="GET"){d.retry=0;}}else{if(d.method!="GET"){d.retry=0;}}}if(c){for(property in c){d[property]=c[property];}}this.setName(a);this.setUri(b);this.setParams(d);this._expireCache(this.getName());},_name:"",_uri:"",_params:new Object(),getName:function(){return this._name;},setName:function(a){if(a==null||typeof a=="undefined"){throw new Error("ERROR mojo.service.Service.setName - name parameter is required");}if(!dojo.isString(a)||a==""){throw new Error("ERROR mojo.service.Service.setName - name parameter must be a non-empty string");}this._name=a;},getUri:function(){return this._uri;},setUri:function(a){if(a==null||typeof a=="undefined"){throw new Error("ERROR mojo.service.Service.setUri - uri parameter is required");}if(!dojo.isString(a)||a==""){throw new Error("ERROR mojo.service.Service.setUri - uri parameter must be a non-empty string");}this._uri=a;},getParams:function(){return this._paramsObj;},setParams:function(d){if(!d){throw new Error("ERROR mojo.service.Service.setParams - paramsObj parameter is required");}if(d){for(property in d){switch(property){case"hijax":case"cache":case"inferArrays":if(typeof d[property]!="boolean"){throw new Error("ERROR mojo.service.Service.setParams - "+property+" property of paramsObj must be a boolean");}break;case"cacheExpiry":case"retry":if(typeof d[property]!="number"){throw new Error("ERROR mojo.service.Service.setParams - "+property+" property of paramsObj must be a number");}break;case"format":if(typeof d[property]!="string"){throw new Error("ERROR mojo.service.Service.setParams - "+property+" property of paramsObj must be a string");}break;case"method":var b=false;for(var c=0,a=this.VALID_METHODS.length;c<a;c++){if(this.VALID_METHODS[c]==d[property].toUpperCase()){b=true;}}if(!b){throw new Error('ERROR mojo.service.Service.setParams - method property of paramsObj must be one of "GET", "POST", "PUT", or "DELETE"');}break;}}}if(!this._paramsObj){this._paramsObj={};}if(d.json==true){this._paramsObj.format="json";if(dojo.config&&dojo.config.isDebug){console.debug("WARNING mojo.service.Service.setParams - json parameter is DEPRECATED; use {format: 'json'} instead");}}if(d.json==false){this._paramsObj.format="text";if(dojo.config&&dojo.config.isDebug){console.debug("WARNING mojo.service.Service.setParams - json parameter is DEPRECATED; use {format: 'json'} instead");}}for(property in d){this._paramsObj[property]=d[property];}},invoke:function(paramsObj,callerObj){if(!callerObj){throw new Error("ERROR mojo.service.Service.invoke - callerObj parameter is required");}if(!dojo.isObject(callerObj)){throw new Error("ERROR mojo.service.Service.invoke - callerObj parameter must be an object");}if(typeof callerObj.onResponse!="function"){throw new Error("ERROR mojo.service.Service.invoke - callerObj parameter must contain an object with an onResponse method");}if(typeof callerObj.onError!="function"){throw new Error("ERROR mojo.service.Service.invoke - callerObj parameter must contain an object with an onError method");}var serviceParams=this.getParams();if(typeof TrimPath!="undefined"&&TrimPath.parseTemplate){var uriFinal=TrimPath.parseTemplate(this.getUri()).process(paramsObj);if(paramsObj&&paramsObj._MODIFIERS&&paramsObj.defined){delete paramsObj._MODIFIERS;delete paramsObj.defined;}}else{var uriFinal=this.getUri();}if(serviceParams.hijax&&callerObj.getRequest()&&callerObj.getRequest().callerObj&&callerObj.getRequest().callerObj.tagName=="A"){uriFinal=callerObj.getRequest().callerObj.href;}var tried=0;var serializeName=this.getName();var pairs=new Array();for(var key in paramsObj){if(typeof(paramsObj[key])!="function"){pairs.push(key+"_"+paramsObj[key]);}else{pairs.push(key+"__function");}}if(pairs.length>0){serializeName+="_"+pairs.join("_");}var errorCallback=function(errorObj,httpObj){var errors=new Array();if(httpObj){errorObj.code=httpObj.status;errors.push(errorObj);}if(typeof(errorObj)=="string"){var msg=errorObj;errorObj=new Object();errorObj.message=msg;}if(errorObj.name){errorObj.code=errorObj.name;errors.push(errorObj);}if(errorObj.errors){errors=errorObj.errors;}if(errorObj.error){errors.push(errorObj.error);}if(errors[0]["redirectUrl"]){window.location.replace(errors[0]["redirectUrl"]);}if(httpObj&&serviceParams.retry>=tried){serviceInvoke();}else{callerObj.onError(errors);}};var thisObj=this;var serviceInvoke=function(){var toSentenceCase=function(string){return string.charAt(0).toUpperCase()+string.replace(/ \w/g,function(m){return m.toUpperCase();}).substring(1);};return dojo["xhr"+toSentenceCase(serviceParams.method.toLowerCase())]({url:uriFinal,preventCache:(!serviceParams.cache&&serviceParams.method=="GET"),handleAs:serviceParams.format,content:paramsObj,load:function(response,ioArgs){tried++;if(ioArgs.handleAs=="json"){if(!dojo.isObject(response)){try{response=eval(response);}catch(ex){errorCallback(ex);return;}}if(response.error||response.errors){errorCallback(response);}else{if(serviceParams.cache){thisObj._setCache(serializeName,response,serviceParams.cacheExpiry);}callerObj.onResponse(response,ioArgs.args.content);}}else{if(ioArgs.handleAs=="xml"){try{var params={};if(typeof serviceParams.inferArrays!="undefined"){params.inferArrays=serviceParams.inferArrays;}response=mojo.helper.XML.toObject(response,params);}catch(ex){errorCallback(ex);}if(response.error||response.errors){if(response.errors&&response.errors.error&&response.errors.error instanceof Array){response.errors=response.errors.error;}errorCallback(response);}else{if(serviceParams.cache){thisObj._setCache(serializeName,response,serviceParams.cacheExpiry);}callerObj.onResponse(response,ioArgs.args.content);}}else{if(serviceParams.cache){thisObj._setCache(serializeName,response,serviceParams.cacheExpiry);}callerObj.onResponse(response,ioArgs.args.content);}}},error:function(response,ioArgs){tried++;errorCallback(response,ioArgs.xhr);}});};var cacheObj;if(serviceParams.cache){cacheObj=this._getCache(serializeName);}if(cacheObj){callerObj.onResponse(cacheObj.data,paramsObj);}else{var currentXhr=serviceInvoke();}return currentXhr;},_setCache:function(a,d,c){var b=0;if(c>0){b=(new Date()).getTime()+(c*1000);}mojo.Model.set(a,{data:d,expiryTime:b});},_getCache:function(c){var a=null;if(mojo.Model.contains(c)){a=mojo.Model.get(c);var b=(new Date()).getTime();if(a.expiryTime>0&&b>a.expiryTime){this._expireCache(c);a=null;}}return a;},_expireCache:function(a){mojo.Model.remove(a);}});dojo.provide("mojo.ModelReference");dojo.declare("mojo.ModelReference",null,{onNotify:function(){},constructor:function(a){if(a==null||typeof a=="undefined"){throw new Error("ERROR mojo.ModelReference - key parameter is required");}if(!dojo.isString(a)||a==""){throw new Error("ERROR mojo.ModelReference - key parameter must be a non-empty string");}this._key=a;__mojoModelReferences[a]=this;},_key:null,getKey:function(){return this._key;},getValue:function(){return mojo.Model.get(this._key);},setValue:function(a){mojo.Model.set(this._key,a);}});dojo.provide("mojo.Model");dojo.require("mojo.ModelReference");__mojoModel=new Array();__mojoModelReferences=new Array();mojo.Model.set=function(a,b){if(a==null||typeof a=="undefined"){throw new Error("ERROR mojo.Model.set - key parameter is required");}if(!dojo.isString(a)||a==""){throw new Error("ERROR mojo.Model.set - key parameter must be a non-empty string");}__mojoModel[a]=dojo.clone(b);mojo.Model.notify(a);};mojo.Model.add=function(b,d){if(b==null||typeof b=="undefined"){throw new Error("ERROR mojo.Model.add - key parameter is required");}if(!dojo.isString(b)||b==""){throw new Error("ERROR mojo.Model.add - key parameter must be a non-empty string");}if(d==null||typeof d=="undefined"){throw new Error("ERROR mojo.Model.add - valueObj parameter is required");}if(d==""){throw new Error("ERROR mojo.Model.add - valueObj parameter must be a non-empty string");}if(mojo.Model.contains(b)){if(!dojo.isArray(__mojoModel[b])){var c=__mojoModel[b];__mojoModel[b]=new Array();__mojoModel[b].push(c);}if(dojo.isArray(d)){for(var a=0;a<d.length;a++){__mojoModel[b].push(d[a]);}}else{__mojoModel[b].push(d);}mojo.Model.notify(b);}else{mojo.Model.set(b,d);}};mojo.Model.get=function(b){if(b==null||typeof b=="undefined"){throw new Error("ERROR mojo.Model.get - key parameter is required");}if(!dojo.isString(b)||b==""){throw new Error("ERROR mojo.Model.get - key parameter must be a non-empty string");}var a=__mojoModel[b];if(typeof a=="undefined"){if(dojo.config&&dojo.config.isDebug){console.debug('WARNING mojo.Model - No entry found for "'+b+'" key');}a=null;}return a;};mojo.Model.getReference=function(a){if(a==null||typeof a=="undefined"){throw new Error("ERROR mojo.Model.getReference - key parameter is required");}if(!dojo.isString(a)||a==""){throw new Error("ERROR mojo.Model.getReference - key parameter must be a non-empty string");}if(!__mojoModelReferences[a]){__mojoModelReferences[a]=new mojo.ModelReference(a);}return __mojoModelReferences[a];};mojo.Model.remove=function(a){if(a==null||typeof a=="undefined"){throw new Error("ERROR mojo.Model.remove - key parameter is required");}if(!dojo.isString(a)||a==""){throw new Error("ERROR mojo.Model.remove - key parameter must be a non-empty string");}var b=mojo.Model.getReference(a);__mojoModel[a]=null;mojo.Model.notify(a);};mojo.Model.contains=function(b){if(b==null||typeof b=="undefined"){throw new Error("ERROR mojo.Model.contains - key parameter is required");}if(!dojo.isString(b)||b==""){throw new Error("ERROR mojo.Model.contains - key parameter must be a non-empty string");}var a=__mojoModel[b];if(a){return true;}return false;};mojo.Model.notify=function(c){if(c==null||typeof c=="undefined"){throw new Error("ERROR mojo.Model.notify - key parameter is required");}if(!dojo.isString(c)||c==""){throw new Error("ERROR mojo.Model.notify - key parameter must be a non-empty string");}__mojoModel.__mojoTemplateControllers=[];var d=mojo.Model.getReference(c);d.onNotify();mojo.Messaging.publish("/mojo/model/"+c);var e=__mojoModel.__mojoTemplateControllers.length;for(var b=0;b<e;b++){var a=__mojoModel.__mojoTemplateControllers[b];if(a&&a.updateController){a._addObservers();a.updateController=null;}}__mojoModel.__mojoTemplateControllers=null;};mojo.Model.addObserver=function(b,a,c){if(b==null||typeof b=="undefined"){throw new Error("ERROR mojo.Model.addObserver - key parameter is required");}if(!dojo.isString(b)||b==""){throw new Error("ERROR mojo.Model.addObserver - key parameter must be a non-empty string");}if(a==null||typeof a=="undefined"){throw new Error("ERROR mojo.Model.addObserver - targetObj parameter is required");}if(!dojo.isObject(a)){throw new Error("ERROR mojo.Model.addObserver - targetObj parameter must be an object");}if(c==null||typeof c=="undefined"){throw new Error("ERROR mojo.Model.addObserver - targetFunc parameter is required");}if(!dojo.isString(c)||c==""){throw new Error("ERROR mojo.Model.addObserver - targetFunc parameter must be a function and is not of type string");}return mojo.Messaging.subscribe("/mojo/model/"+b,a,c);};mojo.Model.removeObserver=function(a){if(a==null||typeof a!="object"){throw new Error("ERROR mojo.Model.removeObserver - handle parameter is required");}mojo.Messaging.unsubscribe(a);};dojo.provide("mojo.History");var __mojoHistory=null;dojo.declare("mojo.History",null,{constructor:function(){var a=this;if(typeof rsh!="undefined"&&rsh.dhtmlHistory&&rsh.dhtmlHistory["_isIE"]){rsh.dhtmlHistory.init();dojo.connect(rsh.dhtmlHistory,"_fireHistoryEvent",function(b){a.setHash(b);a._execute();});}else{this._interval=window.setInterval(function(){a._execute();},100);}},_interval:null,_defaultHash:"",_savedHash:"",_paramsObj:null,_topic:null,onChange:function(){},getHash:function(){var a=window.location.hash;if(a.length>0){a=a.substring(1);}if(a.toLowerCase()=="null"||a.toLowerCase()=="undefined"){a="";}if(a.length==0&&this._defaultHash.length>0){a=this._defaultHash;}return a;},setHash:function(a){if(a==null||typeof a=="undefined"){throw new Error("ERROR mojo.History.setHash - newHash parameter is required");}if(!dojo.isString(a)||a==""){throw new Error("ERROR mojo.History.setHash - newHash parameter must be a non-empty string");}window.location.hash=a;},setDefault:function(a){if(a==null||typeof a=="undefined"){throw new Error("ERROR mojo.History.setDefault - defaultHashObj parameter is required");}if(typeof(a)=="string"){this._defaultHash=a;}else{if(typeof(a)=="object"){this._defaultHash=this._parseObj(a);}}this._execute();},_execute:function(){var a=this.getHash();if(a.length==0&&this._defaultHash.length>0){a=this._defaultHash;}if(this._savedHash!=a){document.title=document.title.replace(window.location.hash,"");this._savedHash=a;this._paramsObj=this._parseHash(this._savedHash);this._topic=this._paramsObj.topic||null;this.onChange();if(this._topic){mojo.Messaging.publish(this._topic,this._paramsObj);}}},_parseHash:function(d){var c=new Object();var b=d.split("&");for(var a=0;a<b.length;a++){var e=b[a].split("=");if(e.length==2){c[e[0]]=unescape(e[1]);}}return c;},_parseObj:function(c){var d=new Array();for(var a in c){d.push(a+"="+escape(c[a].toString()));}var b=d.join("&");return b;},getParams:function(){return this._paramsObj;},getTopic:function(){return this._topic;}});mojo.History.getInstance=function(){if(__mojoHistory==null){__mojoHistory=new mojo.History();}return __mojoHistory;};dojo.provide("mojo.MessagingTopic");dojo.declare("mojo.MessagingTopic",null,{onPublish:function(){},constructor:function(a){if(a==null||typeof a=="undefined"){throw new Error("ERROR mojo.MessagingTopic - topic parameter is required");}if(typeof a=="string"){if(a==""){throw new Error("ERROR mojo.MessagingTopic - topic parameter must be a non-empty string");}}else{throw new Error("ERROR mojo.MessagingTopic - topic parameter is not type String");}this._topic=a;__mojoMessagingTopics[a]=this;},_topic:null,_messageObj:null,getTopic:function(){return this._topic;},getMessage:function(){return this._messageObj;},setMessage:function(a){this._messageObj=a;}});dojo.provide("mojo.Messaging");dojo.require("mojo.MessagingTopic");__mojoMessagingTopics=new Array();mojo.Messaging.publish=function(b,c){if(b==null||typeof b=="undefined"){throw new Error("ERROR mojo.Messaging.publish - topic parameter is required");}if(!dojo.isString(b)||b==""){throw new Error("ERROR mojo.Messaging.publish - topic parameter must be a non-empty string");}var a=mojo.Messaging.getTopic(b);a.setMessage(c);a.onPublish(c);if(!dojo.isArray(c)){c=[c];}dojo.publish(b,c);a.setMessage(null);};mojo.Messaging.subscribe=function(a,b,c){if(a==null||typeof a=="undefined"){throw new Error("ERROR mojo.Messaging.subscribe - topic parameter is required");}if(!dojo.isString(a)||a==""){throw new Error("ERROR mojo.Messaging.subscribe - topic parameter must be a non-empty string");}if(!dojo.isObject(b)&&!dojo.isString(b)){throw new Error("ERROR mojo.Messaging.subscribe - targetObj parameter must be an object or a string");}mojo.Messaging.getTopic(a);return dojo.subscribe(a,b,c);};mojo.Messaging.unsubscribe=function(a){dojo.unsubscribe(a);};mojo.Messaging.getTopic=function(a){if(a==null||typeof a=="undefined"){throw new Error("ERROR mojo.Messaging.getTopic - topic parameter is required");}if(!dojo.isString(a)||a==""){throw new Error("ERROR mojo.Messaging.getTopic - topic parameter must be a non-empty string");}if(!__mojoMessagingTopics[a]){__mojoMessagingTopics[a]=new mojo.MessagingTopic(a);}return __mojoMessagingTopics[a];};dojo.provide("mojo.controller.Param");dojo.declare("mojo.controller.Param",null,{constructor:function(c,a,e,d,b){this._value=null;this._defaultValue=null;this._params=null;this._type=null;this._name=c;this._defaultValue=a;if(d){this._type=d;}if(b){this._params=b;}this.setValue(this._defaultValue);if(typeof e=="boolean"){this._required=e;}},_name:null,_value:null,_defaultValue:null,_required:false,_type:null,_params:null,getName:function(){return this._name;},getValue:function(){return this._value;},setValue:function(b){var d=mojo.helper.Validation.getInstance();var c=this.getRequired();var a=this.getType();if(c&&!d.isRequired(b)){throw new Error("ERROR mojo.controller.Param.setValue - value parameter is required");}if(typeof b=="undefined"){return;}if(a&&!d.isType(b,{type:a})){throw new Error("RROR mojo.controller.Param.setValue - value parameter is invalid type");}if(this.getValue()!=b){this._value=b;this.onChange();if(this._params!=null&&this._params.onChange){this._params.onChange();}}},getDefaultValue:function(){return this._defaultValue;},getRequired:function(){return this._required;},getType:function(){return this._type;},onChange:function(){}});dojo.provide("mojo.controller.Map");__mojoControllerMap=null;dojo.declare("mojo.controller.Map",null,{onComplete:function(){},constructor:function(){mojo.Messaging.subscribe("/mojo/controller/mapControllers",this,"mapControllers");dojo.addOnUnload(dojo.hitch(this,this._mojoCleanup));},_controllers:[],_siteMap:null,getSiteMap:function(){if(!this._siteMap){throw new Error("ERROR mojo.controller.Map - siteMap not set");}return this._siteMap;},setSiteMap:function(f){if(f==null||typeof f=="undefined"){throw new Error("ERROR mojo.controller.Map.setSiteMap - siteMapObj parameter is required");}var b=function(){throw new Error('ERROR mojo.controller.Map.setSiteMap - siteMapObj parameter must consist of patterns in the format {pattern: "pattern", controllers: [{controller: "controller.path"}]}');};if(!dojo.isArray(f)){b();}for(var d=0,a=f.length;d<a;d++){var e=f[d];if(typeof e.pattern=="undefined"||e.pattern==null){b();}if(!dojo.isArray(e.controllers)){b();}for(var c=0,a=e.controllers.length;c<a;c++){if(typeof e.controllers[c].controller=="undefined"||!dojo.isString(e.controllers[c].controller)||e.controllers[c].controller==""){b();}}}for(pattern in f){}this._siteMap=f;},mapControllers:function(c){var b=this.getSiteMap();var k=b.length;for(var e=0;e<k;e++){var g=b[e].pattern;if(typeof(g)=="string"){var a=[];if(c&&typeof(c)=="object"){a=mojo.query(g,c);}else{a=mojo.query(g);}var f=a.length;for(var d=0;d<f;d++){this._mapControllers(b[e].controllers,a[d]);}}else{if(typeof(g)=="function"||typeof(g)=="object"){if(c&&typeof(c)=="string"){var h=new RegExp(g);if(h.test(c)){this._mapControllers(b[e].controllers);}}}else{alert(g);throw new Error("ERROR mojo.controller.Map - siteMap contains invalid pattern");}}}this.onComplete();},_mojoRefs:[],_mojoCleanup:function(){this._mojoRefs.push(document);this._mojoRefs.push(document.body);this._mojoRefs.push(document.documentElement);document.head=document.extend=document.getElementsBySelector=null;for(var b=0;b<this._mojoRefs.length;b++){var c=this._mojoRefs[b];if(!c){continue;}if(c.mojoObservers){for(var a in c.mojoObservers){c[a]=null;}}c.mojoControllers=c.mojoObservers=c.mojoObserve=null;}},_mapControllers:function(f,a){var b=f.length;for(var d=0;d<b;d++){var e=f[d].controller;var g=f[d].params;if(dojo.config&&dojo.config.isDebug){try{this.mapController(e,a,g);}catch(c){console.debug("EXCEPTION: "+c.message+" in mojo.controller.Map.mapController() for controller: "+e);}}else{this.mapController(e,a,g);}}},mapController:function(c,a,d){if(c==null||typeof c=="undefined"){throw new Error("ERROR mojo.controller.Map.mapController - controllerName parameter is required");}if(!dojo.isString(c)||c==""){throw new Error("ERROR mojo.controller.Map.mapController - controllerName parameter must be a non-empty string");}mojo.require(c);var b=mojo.evaluateClassPath(c);if(a){if(!a.mojoControllers){a.mojoControllers={};}if(!a.mojoControllers[c]){a.mojoControllers[c]=new b(a,d);if(!(a.mojoControllers[c] instanceof mojo.controller.Controller)){throw new Error('ERROR mojo.controller.Map.mapController - "'+c+'" must be an instance of mojo.controller.Controller');}}}else{if(!this._controllers[c]){this._controllers[c]=new b(null,d);if(!(this._controllers[c] instanceof mojo.controller.Controller)){throw new Error('ERROR mojo.controller.Map.mapController - "'+c+'" must be an instance of mojo.controller.Controller');}}}}});mojo.controller.Map.mapControllers=function(a){mojo.Messaging.publish("/mojo/controller/mapControllers",[a]);};mojo.controller.Map.getInstance=function(){if(__mojoControllerMap==null){__mojoControllerMap=new mojo.controller.Map();}return __mojoControllerMap;};dojo.provide("mojo.controller.Request");dojo.declare("mojo.controller.Request",null,{constructor:function(f,a,d,b,c,e){this._paramsFunc=null;this.paramsObj=null;this.callerObj=null;this.eventObj=null;this.commandName=null;this.controllerObj=null;this.invocation=null;if(typeof(f)=="function"){this.paramsObj={};this._paramsFunc=f;}else{if(typeof(f)=="object"){this.paramsObj=f;}}if(a==null||typeof a=="undefined"){throw new Error("ERROR mojo.controller.Request.constructor - callerObj is not set");}else{this.callerObj=a;}this.eventObj=d;if(b==null||typeof b=="undefined"){throw new Error("ERROR mojo.controller.Request.constructor - commandName is not set");}else{if(typeof b!="string"){throw new Error("ERROR mojo.controller.Request.constructor - commandName is not type String");}else{this.commandName=b;}}if(c==null||typeof c=="undefined"){throw new Error("ERROR mojo.controller.Request.constructor - controllerObj is not set");}else{if(!(c instanceof mojo.controller.Controller)){throw new Error("ERROR mojo.controller.Request.constructor - controllerObj is not type mojo.controller.Controller");}else{this.controllerObj=c;}}this.invocation=e;},_paramsFunc:null,paramsObj:null,callerObj:null,eventObj:null,commandName:null,controllerObj:null,invocation:null,update:function(){if(this._paramsFunc&&typeof(this._paramsFunc)=="function"){var a=this._paramsFunc(this.getContextElement(),this.getCaller(),this.getController());for(var b in a){this.paramsObj[b]=a[b];}}},getParams:function(){if(!this.paramsObj){this.update();}return this.paramsObj;},getCaller:function(){return this.callerObj;},getContextElement:function(){return this.getController().getContextElement();},getEvent:function(){return this.eventObj;},getCommandName:function(){return this.commandName;},getController:function(){return this.controllerObj;},getControllerName:function(){return this.getController().declaredClass;},getInvocation:function(){return this.invocation;}});dojo.provide("mojo.controller.Controller");dojo.require("mojo.command.Command");dojo.require("mojo.command.Behavior");dojo.require("mojo.command.Rule");dojo.require("mojo.controller.Request");dojo.declare("mojo.controller.Controller",null,{constructor:function(a,b){this._init(a,b);dojo.addOnUnload(dojo.hitch(this,this._mojoCleanup));},_mojoCleanup:function(){this.removeObservers();this.contextElementObj=null;},_contextElementObj:null,_commands:[],_connectHandles:[],_queryCache:{},_observers:{},_tags:[],_init:function(a,e){if(this.params){var d={};d.onChange=function(){};var f=this._getBaseProperty("params");for(var b in f){if(typeof f[b]=="object"){var c=f[b];d[b]=new mojo.controller.Param(b,dojo.clone(c.defaultValue),c.required,c.type,d);if(e){d[b].setValue(e[b]);}}}for(var b in this.params){if(typeof this.params[b]=="object"){var c=this.params[b];d[b]=new mojo.controller.Param(b,dojo.clone(c.defaultValue),c.required,c.type,d);if(e){d[b].setValue(e[b]);}}}this.params=d;d=null;e=null;}this._contextElementObj=null;if(a){this._contextElementObj=a;}this._commands=[];this._tags=[];this._connectHandles=[];this._callBaseMethod("addCommands");this.addCommands();this._addObservers();this._callBaseMethod("addIntercepts");this.addIntercepts();this.onInit();if(this.params){for(var b in this.params){if(typeof this.params[b]=="object"){var c=this.params[b];if(c.getValue()!=null){c.onChange();}}}}mojo.Messaging.subscribe("/mojo/controller/"+this.declaredClass+"/addObservers",this,"_addObservers");mojo.Messaging.subscribe("/mojo/controller/addObservers",this,"_addObservers");},getConfig:function(a){a=a.toLowerCase();switch(a){case"params":return this[a];break;}return null;},getValue:function(a){return this.params[a].getValue();},setValue:function(b,a){this.params[b].setValue(a);},getContextController:function(a){if(this.getContextElement()&&this.getContextElement().mojoControllers[a]){return this.getContextElement().mojoControllers[a];}return null;},_getBaseProperty:function(b){var a=mojo.evaluateClassPath(this.declaredClass);var c=a.superclass;if(c.declaredClass!="mojo.controller.Controller"&&c[b]){return c[b];}return null;},_callBaseMethod:function(a){var b=this._getBaseProperty(a);if(b){b.call(this);}},getContextElement:function(){if(!this._contextElementObj){return null;}return this._contextElementObj;},onInit:function(){},_addObservers:function(){this._queryCache={};this._observers={};this._callBaseMethod("addObservers");this.addObservers();for(var b in this._queryCache){if(this._queryCache[b]["length"]){for(var d in this._observers[b]){if(this._observers[b][d]["length"]){var c=this._queryCache[b].length;for(var a=0;a<c;a++){this._addObserver(this._queryCache[b][a],d,this._observers[b][d]);}}}}}this._queryCache={};this._observers={};},addObservers:function(){throw new Error("ERROR mojo.controller.Controller.addObservers - addObservers() method is not implemented");},removeObservers:function(){var a=this._connectHandles.length;for(var b=0;b<a;b++){dojo.disconnect(this._connectHandles[b]);}},addObserver:function(j,e,h,f){var a=function(l){if(!dojo.isArray(l)){return false;}for(var m=0,k=l.length;m<k;m++){if(typeof(l[m])!="string"){return false;}}return true;};if(!j){return;}if(!e){throw new Error("ERROR mojo.controller.Controller.addObserver - srcFunc is not set");}if(typeof(e)!="string"){throw new Error("ERROR mojo.controller.Controller.addObserver - srcFunc is not type String");}if(!h){throw new Error("ERROR mojo.controller.Controller.addObserver - cmdName is not set");}if(typeof(h)!="string"&&h!=null){throw new Error("ERROR mojo.controller.Controller.addObserver - cmdName is not type String");}if(typeof(j)=="string"||a(j)){if(!dojo.isArray(j)){j=[j];}for(var d=0,g=j.length;d<g;d++){var c=j[d];if(this.getContextElement()&&e.match(/^onclick|onmouse|onkey|onmove/)!=null){this._addObserver(this.getContextElement(),e,[{cmdName:h,paramsObj:f,eventDelegate:c}]);}else{if(!this._queryCache[c]){this._queryCache[c]=mojo.query(c,this.getContextElement());}if(!this._observers[c]){this._observers[c]={};}if(!this._observers[c][e]){this._observers[c][e]=[];}var b=this._observers[c][e].length;this._observers[c][e][b]={cmdName:h,paramsObj:f};}}}else{if(!dojo.isArray(j)){j=[j];}for(var d=0,g=j.length;d<g;d++){this._addObserver(j[d],e,[{cmdName:h,paramsObj:f}]);}}if(!(this._commands[h])||this._commands[h]==null){throw new Error("ERROR mojo.controller.Controller.addObserver - cmdName does not reference a Command in the Controller");}},_addObserver:function(j,d,a){mojo.controller.Map.getInstance()._mojoRefs.push(j);var b=[];var e=a.length;for(var c=0;c<e;c++){if(typeof(a[c].eventDelegate)=="undefined"){a[c].eventDelegate="";}if(!this._observerIsTagged(j,d+a[c].eventDelegate,a[c])){b.push(a[c]);this._tagObserver(j,d+a[c].eventDelegate,a[c]);}}if(!j.mojoObservers){j.mojoObservers={};}if(!j.mojoObservers[d]){j.mojoObservers[d.toLowerCase()]=[];}if(b.length>0){var h=this;var g=function(o){var n=function(r){var r=r||window.event;var i=r.target||r.srcElement;if(i.nodeType==3){i=i.parentNode;}return i;};if(h.getContextElement()&&h.getContextElement().parentNode==null){h.removeObservers();}else{var p=b.length;for(var l=0;l<p;l++){if(typeof(mojo)!="undefined"){var k=j;if(b[l].eventDelegate.length>0){var m=n(o);k=mojo.queryMatch(m,b[l].eventDelegate,h.getContextElement(),true);}if(k!=null){var q=h._setRequest(b[l].paramsObj,k,o,b[l].cmdName);h.fireCommandChain(b[l].cmdName,q);}}}}};var f=dojo.connect(j,d,g);this._connectHandles.push(f);j.mojoObservers[d.toLowerCase()].push(g);}},_tagObserver:function(a,e,d){if(!a.mojoObserve){a.mojoObserve={};}if(typeof a.mojoObserve[this.declaredClass]=="undefined"){var f=this._tags.length;a.mojoObserve[this.declaredClass]=f;this._tags[f]={};}var c=a.mojoObserve[this.declaredClass];var b=this._generateTagKey(e,d);if(this._tags[c]&&!this._tags[c][b]){this._tags[c][b]=true;}},_generateTagKey:function(d,c){var b=d+"_"+c.cmdName;if(c.paramsObj){var e;if(typeof(c.paramsObj)=="function"){e=c.paramsObj.toString();}else{if(typeof(c.paramsObj)=="object"){for(var a in c.paramsObj){if(c.paramsObj[a]){e+=a+":"+c.paramsObj[a].toString()+",";}}}}b+="_"+e;}return b;},_observerIsTagged:function(a,d,c){if(!a.mojoObserve){a.mojoObserve={};}var e=false;var b=this._generateTagKey(d,c);if(typeof a.mojoObserve[this.declaredClass]!="undefined"&&this._tags[a.mojoObserve[this.declaredClass]]&&this._tags[a.mojoObserve[this.declaredClass]][b]){e=true;}return e;},addCommands:function(){throw new Error("ERROR mojo.controller.Controller.addCommands - addCommands() method is not implemented");},addCommand:function(b,a){if(!b){throw new Error("ERROR mojo.controller.Controller.addCommand - cmdName is not set");}if(typeof(b)!="string"){throw new Error("ERROR mojo.controller.Controller.addCommand - cmdName is not type String");}if(!a){throw new Error("ERROR mojo.controller.Controller.addCommand - cmdObjPath is not set");}if(typeof(a)!="string"){throw new Error("ERROR mojo.controller.Controller.addCommand - cmdObjPath is not type String");}if(!this._commands[b]){this._commands[b]=[];}var c=function(f,d,h){dojo.require(d);var e=mojo.evaluateClassPath(d);var g=new e();if((g instanceof mojo.command.Command)||(g instanceof mojo.command.Rule)||(g instanceof mojo.command.Behavior)){h._commands[f].push(g);}else{throw new Error("ERROR mojo.controller.Controller.addCommand - Command object is not type mojo.command.Command or mojo.command.Behavior or mojo.command.Rule");}};c(b,a,this);},getCommand:function(a){if(!a){throw new Error("ERROR mojo.controller.Controller.getCommand - cmdName is not set");}if(typeof(a)!="string"){throw new Error("ERROR mojo.controller.Controller.getCommand - cmdName is not type String");}if(this._commands[a]){return this._commands[a][0];}throw new Error("ERROR mojo.controller.Controller.getCommand - cmdName does not reference a Command in the Controller");},getCommandChain:function(a){if(!a){throw new Error("ERROR mojo.controller.Controller.getCommandChain - cmdName is not set");}if(typeof(a)!="string"){throw new Error("ERROR mojo.controller.Controller.getCommandChain - cmdName is not type String");}if(!this._commands[a]){throw new Error("ERROR mojo.controller.Controller.getCommandChain - cmdName does not reference a Command in the Controller");}if(this._commands[a]){return this._commands[a];}return null;},fireCommandChain:function(a,d){var c=this._commands[a].length;for(var b=0;b<c;b++){this._commands[a][b]._execute(d);}},addIntercepts:function(){throw new Error("ERROR mojo.controller.Controller.addIntercepts - addIntercepts() method is not implemented");},addIntercept:function(g,f,b,e){if(!g){throw new Error("ERROR mojo.controller.Controller.addIntercept - interceptType is not set");}if(typeof(g)!="string"){throw new Error("ERROR mojo.controller.Controller.addIntercept - interceptType is not type String");}if(g=="before"||g=="after"||g=="around"){}else{throw new Error('ERROR mojo.controller.Controller.addIntercept - interceptType is not "before", "after", or "around"');}if(!f){throw new Error("ERROR mojo.controller.Controller.addIntercept - interceptCmdName is not set");}if(typeof(f)!="string"){throw new Error("ERROR mojo.controller.Controller.addIntercept - interceptCmdName is not type String");}if(!b){throw new Error("ERROR mojo.controller.Controller.addIntercept - cmdName is not set");}if(typeof(b)!="string"){throw new Error("ERROR mojo.controller.Controller.addIntercept - cmdName is not type String");}if(f.toString()==b.toString()){throw new Error("ERROR mojo.controller.Controller.addIntercept - a command cannot add advice to itself");}if(!this._commands[f]){throw new Error("ERROR mojo.controller.Controller.addIntercept - interceptCmdName does not reference a Command in the Controller");}if(!this._commands[b]){throw new Error("ERROR mojo.controller.Controller.addIntercept - cmdName does not reference a Command in the Controller");}var c=this;var d=this.getCommand(f)["_execute"];var a=function(h){if(typeof(mojo)!="undefined"){requestObj=c._setRequest(e,h.args[0].callerObj,h.args[0].eventObj,b,h);c.fireCommandChain(b,requestObj);}};switch(g){case"before":this._commands[f][0]["_execute"]=function(){var h={args:arguments,calleeObj:this};a.apply(this,[h]);return d.apply(this,arguments);};break;case"after":this._commands[f][0]["_execute"]=function(){var h={args:arguments,calleeObj:this};d.apply(this,arguments);return a.apply(this,[h]);};break;case"around":this._commands[f][0]["_execute"]=function(){var h={args:arguments,calleeObj:this};h.proceed=function(){return d.apply(this.calleeObj,this.args);};return a.apply(this,[h]);};break;}},_setRequest:function(e,a,c,b,d){var f=new mojo.controller.Request(e,a,c,b,this,d);return f;}});mojo.controller.Controller.updateObservers=function(a){if(a){mojo.Messaging.publish("/mojo/controller/"+a+"/addObservers");}else{mojo.Messaging.publish("/mojo/controller/addObservers");}};